; Copyright (C) 2024 Intel Corporation
; SPDX-License-Identifier: BSD-3-Clause

; RUN: %tinytc-opt -plower-coopmatrix < %s | filecheck %s

func @coopmatrix_a_store_n(%A: memref<i32x64x48>, %x: index, %y: index) subgroup_size(16) {
    parallel {
        %0 = constant 1 : coopmatrix<i32x16x3,matrix_a>
        cooperative_matrix_store %0, %A[%x,%y]
    }
; CHECK:      %0 = constant 1 : i32
; CHECK-NEXT: %1 = builtin.subgroup_local_id : i32
; CHECK-NEXT: %2 = cast %1 : index
; CHECK-NEXT: %3 = arith.add %x, %2 : index
; CHECK-NEXT: %4 = subview %A[%3,%y:3] : memref<i32x3,strided<64>>
; CHECK-NEXT: %5 = constant 0 : index
; CHECK-NEXT: store %0, %4[%5]
; CHECK-NEXT: %6 = constant 1 : index
; CHECK-NEXT: store %0, %4[%6]
; CHECK-NEXT: %7 = constant 2 : index
; CHECK-NEXT: store %0, %4[%7]
}

